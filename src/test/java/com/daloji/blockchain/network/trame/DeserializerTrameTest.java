package com.daloji.blockchain.network.trame;


import java.util.ArrayDeque;

import org.junit.Assert;
import org.junit.Test;

import com.daloji.blockchain.core.Utils;
import com.daloji.blockchain.network.IPVersion;
import com.daloji.blockchain.network.peers.PeerNode;


public class DeserializerTrameTest {
	
	private static String trame="F9BEB4D976657273696F6E000000000066000000E853E24E7F1101000D0400000000000034D51C5E00000000000000000000000000000000000000000000FFFF55AA707389C60D04000000000000000000000000000000000000000000000000012A799748954F40102F5361746F7368693A302E31382E302F6159090001F9BEB4D976657261636B000000000000000000005DF6E0E2";

	private static String partial_trame="F9BEB4D976657273696F6E000000000068000000C79722900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";

	@Test
	public  void  deserialiseTest_OK() {
		
		PeerNode peer = new PeerNode(IPVersion.IPV4);
		peer.setHost("127.0.0.1");
		peer.setPort(8333);
		ArrayDeque<TrameHeader> stackCommand = DeserializerTrame.getInstance().deserialise(Utils.hexStringToByteArray(trame), peer);
		Assert.assertNotNull(stackCommand); 
		Assert.assertEquals(stackCommand.size(), 2);
		TrameHeader trameheader = stackCommand.pop();
		Assert.assertTrue(trameheader instanceof VersionTrameMessage);
		trameheader = stackCommand.getFirst();
		Assert.assertTrue(trameheader instanceof VersionAckTrame);
		
	}
	
	@Test
	public void deserialiseTestPartialTram() {
		PeerNode peer = new PeerNode(IPVersion.IPV4);
		peer.setHost("127.0.0.1");
		peer.setPort(8333);
		ArrayDeque<TrameHeader> stackCommand = DeserializerTrame.getInstance().deserialise(Utils.hexStringToByteArray(partial_trame), peer);
		Assert.assertNotNull(stackCommand); 
		Assert.assertEquals(stackCommand.size(), 1);
		TrameHeader trameheader = stackCommand.pop();
		Assert.assertTrue(trameheader instanceof VersionTrameMessage);

	}
	
	
	@Test
	public void deserialise_001() {
		String trame = "F9BEB4D970696E6700000000000000000800000095C4B6569731BEF7F83EBDEFF9BEB4D96164647200000000000000001F00000012A6028B011E29135E000000000000000000000000000000000000FFFF34C60702208DF9BEB4D967657468656164657273000005040000259959F67F1101001FB4CBE4C778CBD72FBD8A82A9B7814962F299400CD90C0F000000000000000000B1A9BEFE16213662E275C06EF2FD7B38F62E1169D1D60E00000000000000000086A70568B0FD5CD5D00D4768137AE80469A02ED8676D000000000000000000000F20E6800CA85ABCFAF804F229CD7F780916F00CA097090000000000000000001B405390134E922CA5BAA7987464DF0B65864AE19CC20600000000000000000031257FE7D2E0C884EAE78C2C51C85633C3AC2482E0BF130000000000000000002DE5C6C0BA33F2EFEF320C7891CA58E68531DC2E3A1E06000000000000000000229887C71E2EF65D776E57A3004AF35327E105E6C00303000000000000000000A638D624975F292E713C8D22BA3C3404670F7C680EBD01000000000000000000ECA92049069C2610C06FEC2ACD71CCF1F16A6CB2397F0E00000000000000000017295DEE509BC39275056A887A065C4763E5F10E3DC20C0000000000000000008B750AA429984D588172CE5037370ACDCE1AEE61CE5D0D0000000000000000008B0E81787DFD1C3A0A7699BCEA7D7AD63136B30619B80B000000000000000000E3D1A2B6028A2B58618E19D41DE4C140A361CFC7725F10000000000000000000F7DD653750E6B63F79174EA77BFA25FC2DEC86379D260400000000000000000056351E085D495D65F84C50531F1434EF53EC105593A0010000000000000000006C7BE70E862DC59EE39F5FA9F09C22D482D1E43ED89D08000000000000000000CA358209C26AC737AE9077E83E508D0080DBC6BCCE300100000000000000000084C39A32DCE2CC257E885749773DC2B45C60DE85349B0300000000000000000024371F6917F9657B5546CF1CE0C88D5201B1EF7C57B5010000000000000000005C10128231F8EBB76A2767E560B22A15466D5DB810650F00000000000000000063A6C249375D164A16F60BFB4DED78CC04AC086712D2120000000000000000002A64E403C2C92F5A701B9415DE9459411941165958B40C000000000000000000C8E8EA6C3BF6BFE9D30C6D91A8AD8CC31D8D8C6CB6210D0000000000000000006E9EE62DF9E40F08C33505971FFF11A1074EAE2700820D000000000000000000140F5B9C4D6B98EA943A6B867F6474DDEC8FB44042D3190000000000000000002DD6D6DD566FFC718A2BB27279969127F3616CE3AFB21E000000000000000000AEFCC45523EE6A84B4A3F3C15F417B1CBFDD4F6B5EA8140100000000000000001E65DEE634DFCF597775EB81";
		PeerNode peer = new PeerNode(IPVersion.IPV4);
		peer.setHost("127.0.0.1");
		peer.setPort(8333);
		ArrayDeque<TrameHeader> stackCommand = DeserializerTrame.getInstance().deserialise(Utils.hexStringToByteArray(trame), peer);
		Assert.assertNotNull(stackCommand); 
		Assert.assertEquals(stackCommand.size(), 3);
		TrameHeader trameheader = stackCommand.pop();

	}
}
